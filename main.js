(()=>{"use strict";function e(e){e.classList.add("popup_opened"),document.addEventListener("keydown",o),e.addEventListener("click",n)}function t(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",o),e.removeEventListener("click",n)}function o(e){"Escape"===e.key&&t(document.querySelector(".popup_opened"))}function n(e){e.target.classList.contains("popup")&&t(e.target)}var r={baseUrl:"https://nomoreparties.co/v1/plus-cohort-14",headers:{authorization:"21ec355f-df00-4771-88de-f3c59b8377f4","Content-Type":"application/json"}};function c(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var u=function(e){return fetch("".concat(r.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:r.headers}).then(c)},a=function(e){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:r.headers}).then(c)},i=function(e){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:r.headers}).then(c)},l=document.querySelector(".popup_type_image"),s=document.querySelector(".popup__image"),d=document.querySelector(".popup__caption"),p=document.querySelector("#card-template").content;function _(t,o,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,c=p.querySelector(".card").cloneNode(!0),_=c.querySelector(".card__image"),f=c.querySelector(".card__heading"),m=c.querySelector(".card__like-button"),v=c.querySelector(".card__delete-button"),y=c.querySelector(".card__like-count");return _.src=t,_.alt=o,y.textContent=r,_.addEventListener("click",(function(){e(l),s.src=t,s.alt=o,d.textContent=o})),f.textContent=o,m.addEventListener("click",(function(e){m.classList.contains("card__like-button_active")&&i(n).then((function(e){y.textContent=e.likes.length})),m.classList.contains("card__like-button_active")||a(n).then((function(e){y.textContent=e.likes.length})),e.target.classList.toggle("card__like-button_active")})),v.addEventListener("click",(function(){v.closest(".card").remove(),u(n)})),c}function f(e,t){e.prepend(t)}function m(e,t){e.classList.add(t.inactiveButtonClass),e.setAttribute("disabled","disabled")}function v(e,t){e.classList.remove(t.inactiveButtonClass),e.removeAttribute("disabled")}function y(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?v(t,o):m(t,o)}var h,S=document.querySelector(".popup__place"),b=document.querySelector(".popup__url"),q=document.querySelector(".popup_type_add-cards"),k=document.querySelector(".gallery"),L=document.querySelector(".profile__image"),E=document.querySelector(".popup__edit-image"),g=document.querySelector(".popup_type_edit-profile-image"),C=document.querySelector(".profile__name"),x=document.querySelector(".profile__occupation"),A=document.querySelector(".popup__name"),U=document.querySelector(".popup__job"),B=document.querySelector(".popup_type_edit-profile"),T=document.querySelectorAll(".popup__close-button"),D=document.querySelector(".profile__edit-button"),P=document.querySelector(".profile__add-button"),j=document.querySelector(".profile__image-edit"),N=B.querySelector(".popup__form"),O=q.querySelector(".popup__form"),w=g.querySelector(".popup__form"),J={formSelector:".popup__form",inputSelector:".popup__text",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_inactive",inputErrorClass:"popup__text_type_error",errorClass:"popup__text-error_active"};function M(e){e?document.querySelectorAll(".popup__save-button").forEach((function(e){e.value="Сохранить..."})):document.querySelectorAll(".popup__save-button").forEach((function(e){e.value="Сохранить"}))}D.addEventListener("click",(function(){e(B),A.value=C.textContent,U.value=x.textContent,v(B.querySelector(J.submitButtonSelector),J)})),P.addEventListener("click",(function(){e(q)})),j.addEventListener("click",(function(){E.value="",e(g)})),T.forEach((function(e){e.addEventListener("click",(function(){t(e.closest(".popup"))}))})),h=J,Array.from(document.querySelectorAll(h.formSelector)).forEach((function(e){!function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);y(o,n,t),o.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""}(e,t,o):function(e,t,o,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(e,t,t.validationMessage,o)}(e,r,t),y(o,n,t)}))}))}(e,h)})),O.addEventListener("submit",(function(e){var o,n;e.preventDefault(),M(!0),(o=S.value,n=b.value,fetch("".concat(r.baseUrl,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify({name:o,link:n})}).then(c)).then((function(e){f(k,_(e.link,e.name,e._id,e.likes.length,e.likes)),document.querySelector(".card__delete-button").classList.add("card__delete-button_visible"),t(q),m(q.querySelector(J.submitButtonSelector),J),document.forms.addCard.reset()})).catch((function(e){return console.log(e)})).finally((function(){return M(!1)}))})),w.addEventListener("submit",(function(e){var o;e.preventDefault(),L.src=E.value,t(g),M(!0),(o=E.value,fetch("".concat(r.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:o})}).then(c)).catch((function(e){return console.log(e)})).finally((function(){return M(!1)})),m(g.querySelector(J.submitButtonSelector),J)})),N.addEventListener("submit",(function(e){var o,n;e.preventDefault(),M(!0),C.textContent=A.value,x.textContent=U.value,(o=A.value,n=U.value,fetch("".concat(r.baseUrl,"/users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:o,about:n})}).then(c)).catch((function(e){return console.log(e)})).finally((function(){return M(!1)})),t(B)})),fetch("".concat(r.baseUrl,"/cards"),{headers:r.headers}).then(c).then((function(e){e.reverse().forEach((function(e){f(k,_(e.link,e.name,e._id,e.likes.length,e.likes)),"8526b46f4ab7627011941e9a"===e.owner._id&&document.querySelector(".card__delete-button").classList.add("card__delete-button_visible"),e.likes.forEach((function(e){"8526b46f4ab7627011941e9a"===e._id?document.querySelector(".card__like-button").classList.add("card__like-button_active"):document.querySelector(".card__like-button").classList.remove("card__like-button_active")}))}))})).catch((function(e){console.log(e)})),fetch("".concat(r.baseUrl,"/users/me"),{headers:r.headers}).then(c).then((function(e){C.textContent=e.name,x.textContent=e.about,L.src=e.avatar})).catch((function(e){console.log(e)}))})();